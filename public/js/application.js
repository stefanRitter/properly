angular.module("app",["ngResource","ngRoute"]),angular.module("app").config(["$routeProvider","$locationProvider",function(a,b){"use strict";var c={user:{auth:["appAuth",function(a){return a.authorizeLoggedInUserForRoute()}]}};b.html5Mode(!0),b.hashPrefix("!"),a.when("/",{templateUrl:"/partials/index/index",controller:"appIndexCtrl"}).when("/map",{templateUrl:"/partials/map/map",controller:"appMapCtrl"}).when("/pro",{templateUrl:"/partials/pro/pro",controller:"appProCtrl"}).when("/saved",{templateUrl:"/partials/saved/saved",controller:"appSavedCtrl"}).when("/login",{templateUrl:"/partials/account/login",controller:"appLoginCtrl"}).when("/join",{templateUrl:"/partials/account/join",controller:"appJoinCtrl"}).when("/home/:id",{templateUrl:"/partials/homes/show",controller:"appHomeShowCtrl"}),a.when("/pro/dashboard",{templateUrl:"/partials/pro/dashboard",controller:"appProDashboardCtrl"}).when("/pro/tenant/:id",{templateUrl:"/partials/profile/show",controller:"appProfileShowCtrl"}).when("/pro/home/:id/:step",{templateUrl:"/partials/homes/edit",controller:"appHomeEditCtrl"}).when("/pro/home/:id",{templateUrl:"/partials/homes/show",controller:"appHomeEditCtrl"}),a.when("/verify",{templateUrl:"/partials/profile/edit",controller:"appVerifyCtrl"}).when("/account/profile",{templateUrl:"/partials/profile/edit",controller:"appProfileEditCtrl",resolve:c.user}),a.when("/account/settings",{templateUrl:"/partials/account/settings",controller:"appSettingsCtrl",resolve:c.user})}]),angular.module("app").run(["$rootScope","$location",function(a,b){"use strict";a.$on("$routeChangeError",function(a,c,d,e){"not authorized"===e&&b.path("/")})}]),angular.module("app").factory("AppUser",["$resource","$rootScope",function(a,b){"use strict";var c=a("/api/users/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return c.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},c.prototype.addBuzzr=function(a){-1===this.buzzrs.indexOf(a)&&(this.buzzrs.push(a),this.$update(),b.$broadcast("buzzrsChanged"))},c.prototype.removeBuzzr=function(a){var c=this.buzzrs.indexOf(a);c>-1&&(this.buzzrs.splice(c,1),this.$update(),b.$broadcast("buzzrsChanged"))},c.prototype.saveLink=function(a){this.recordActivity("saved",a.url,a.topic),this.readlater.push(a),this.$update(),b.$broadcast("readlaterChanged")},c.prototype.removeSavedLink=function(a){var c=-1;this.readlater.forEach(function(b,d){b.url===a&&(c=d)}),c>-1&&(this.readlater.splice(c,1),this.$update(),b.$broadcast("readlaterChanged"))},c.prototype.removeLink=function(a,c){this.recordActivity("removed",a,c),this.$update(),b.$broadcast("removedLink")},c.prototype.trackView=function(a,b){this.recordActivity("viewed",a,b),this.$update()},c.prototype.trackShare=function(a,b){this.recordActivity("shared",a,b),this.$update()},c.prototype.recordActivity=function(a,b,c){var d=-1;this.activities.forEach(function(a,b){a.topic===c&&(d=b)}),-1===d&&(this.activities.push({topic:c,removed:[],viewed:[],saved:[],shared:[]}),d=0),this.activities[d][a].push(b)},c}]),angular.module("app").factory("appAuth",["$http","$q","$rootScope","appIdentity","AppUser",function(a,b,c,d,e){"use strict";return{authenticateUser:function(c,f){var g=b.defer();return a.post("/login",{email:c,password:f}).then(function(a){if(a.data.success){var b=new e;angular.extend(b,a.data.user),d.currentUser=b,g.resolve(!0)}else g.resolve(!1)}),g.promise},createUser:function(a){var c=new e(a),f=b.defer();return c.$save().then(function(){d.currentUser=c,f.resolve(!0)},function(a){f.reject(a.data.reason)}),f.promise},updateCurrentUser:function(a){var c=b.defer();return a.$update().then(function(){d.currentUser=a,c.resolve(!0)},function(a){c.reject(a.data.reason)}),c.promise},logoutUser:function(){var c=b.defer();return a.post("/logout",{logout:!0}).then(function(){d.currentUser=void 0,c.resolve(!0)}),c.promise},authorizeCurrentUserForRoute:function(a){return d.isAuthorized(a)?!0:b.reject("not authorized")},authorizeLoggedInUserForRoute:function(){return d.isAuthenticated()?!0:b.reject("not authorized")}}}]),angular.module("app").factory("appIdentity",["$window","$location","AppUser",function(a,b,c){"use strict";var d={currentUser:void 0,isAuthenticated:function(){return!!this.currentUser},isAuthorized:function(a){return!!this.currentUser&&this.hasRole(a)},hasRole:function(a){return this.currentUser.isAdmin()||this.currentUser.roles.indexOf(a)>-1}};if(a.bootstrappedUser){var e=new c;angular.extend(e,a.bootstrappedUser),d.currentUser=e}return d}]),angular.module("app").controller("appJoinCtrl",["$scope","$location","appAuth","appNotifier",function(a,b,c,d){"use strict";a.signup=function(){var e={email:a.email,password:a.password};c.createUser(e).then(function(){b.path("/verify")},function(b){d.error(b,a)})}}]),angular.module("app").controller("appLoginCtrl",["$scope","$location","appAuth","appNotifier","appIdentity",function(a,b,c,d,e){"use strict";a.signin=function(){c.authenticateUser(a.email,a.password).then(function(c){c?b.path(e.hasRole("pro")?"/pro/dashboard":"/map"):d.error("email/password combination incorrect",a)})}}]),angular.module("app").controller("appSettingsCtrl",["$scope","$location","appAuth","appIdentity","appNotifier",function(a,b,c,d,e){"use strict";a.currentUser=angular.copy(d.currentUser),a.email={valid:d.currentUser.email.match(/^[\S]+@[\S]+\.[\S]+$/)},a.update=function(){c.updateCurrentUser(a.currentUser).then(function(){return a.email.valid?void e.notify("Your account has been updated",a):b.path("/")},function(b){e.error(b,a)})}}]),angular.module("app").controller("appVerifyCtrl",["$scope",function(a){"use strict";a.verify=function(){window.alert()}}]),angular.module("app").controller("appAdminUsersCtrl",["$scope","AppUser",function(a,b){"use strict";a.users=b.query()}]),angular.module("app").directive("checklistModel",["$parse","$compile",function(a,b){"use strict";function c(a,b){if(angular.isArray(a))for(var c=0;c<a.length;c++)if(angular.equals(a[c],b))return!0;return!1}function d(a,b){a=angular.isArray(a)?a:[];for(var c=0;c<a.length;c++)if(angular.equals(a[c],b))return a;return a.push(b),a}function e(a,b){if(angular.isArray(a))for(var c=0;c<a.length;c++)if(angular.equals(a[c],b)){a.splice(c,1);break}return a}function f(f,g,h){b(g)(f);var i=a(h.checklistModel),j=i.assign,k=a(h.checklistValue)(f.$parent);f.$watch("checked",function(a,b){if(a!==b){var c=i(f.$parent);a===!0?j(f.$parent,d(c,k)):j(f.$parent,e(c,k))}}),f.$parent.$watch(h.checklistModel,function(a){f.checked=c(a,k)},!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(a,b){if("INPUT"!==a[0].tagName||!a.attr("type","checkbox"))throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!b.checklistValue)throw"You should provide `checklist-value`.";return a.removeAttr("checklist-model"),a.attr("ng-model","checked"),f}}}]),angular.module("app").factory("appIsMobile",function(){"use strict";var a={Android:function(){return navigator.userAgent.match(/Android/i)?!0:!1},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)?!0:!1},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)?!0:!1},Windows:function(){return navigator.userAgent.match(/IEMobile/i)?!0:!1},any:function(){return a.Android()||a.BlackBerry()||a.iOS()||a.Windows()}};return a}),angular.module("app").factory("appNotifier",function(){"use strict";return{notify:function(a,b){b.notifier={},b.notifier.notice=a,setTimeout(function(){b.notifier.notice="",b.$digest()},4e3)},error:function(a,b){b.notifier={},b.notifier.error=a,setTimeout(function(){b.notifier.error="",b.$digest()},4e3)}}}),angular.module("app").filter("timeAgoFromId",function(){"use strict";function a(a){var b=new Date((a||"").replace(/-/g,"/").replace(/[TZ]/g," ")),c=((new Date).getTime()-b.getTime())/1e3,d=Math.floor(c/86400);if(!(isNaN(d)||0>d||d>=31))return 0===d&&(60>c&&"just now"||120>c&&"1 minute ago"||3600>c&&Math.floor(c/60)+" minutes ago"||7200>c&&"1 hour ago"||86400>c&&Math.floor(c/3600)+" hours ago")||1===d&&"Yesterday"||7>d&&d+" days ago"||31>d&&Math.ceil(d/7)+" weeks ago"}function b(a){return new Date(1e3*parseInt(a.slice(0,8),16)).toISOString()}return function(c){if(c){var d=b(c);return a(d)}}}),angular.module("app").factory("appTopics",["$window",function(a){"use strict";var b=[];return a.bootstrappedTopics&&(b=a.bootstrappedTopics),b}]),angular.module("app").factory("appFeedback",["$rootScope",function(a){"use strict";return{toggle:function(){a.$broadcast("toggleFeedback")}}}]),angular.module("app").controller("appFeedbackCtrl",["$scope","$location","$window","$http","appIdentity","appNotifier",function(a,b,c,d,e,f){"use strict";a.success=!1,a.show=!1,a.feedback={},a.feedback.userAgent=c.navigator.userAgent,e.isAuthenticated()&&(a.feedback.name=e.currentUser.name,a.feedback.email=e.currentUser.email),a.send=function(){a.feedback.currentPath=b.path(),d.post("/api/feedback",a.feedback).then(function(b){b.data.success?a.success=!0:f.error(b.data.err||"unknown error",a)},function(b){f.error("error "+b.status+" occurred - please email help@buzzr.io",a)})},a.toggle=function(){a.show=!a.show},a.$on("toggleFeedback",function(){a.toggle()})}]),angular.module("app").controller("appHeaderCtrl",["$scope","$location","appIdentity","appAuth",function(a,b,c,d){"use strict";a.onPath=function(){for(var a=0,c=arguments.length;c>a;a++)if(arguments[a]===b.path())return!0},a.isLoggedIn=function(a){return a?c.isAuthorized(a):c.isAuthenticated()},a.signout=function(){d.logoutUser().then(function(){b.path("/")})},a.toggleDropdown=function(){a.openDropdown=!a.openDropdown}}]),angular.module("app").factory("AppHome",["$resource",function(a){"use strict";var b=a("/api/homes/:id",{_id:"@id"},{});return b}]),angular.module("app").factory("appCachedHome",["AppHome",function(a){"use strict";var b={};return{get:function(c){return"new"===c?b=new a:b._id!==c&&(b=a.get({id:c})),b},set:function(a){b=a}}}]),angular.module("app").factory("appCachedHomes",["AppHome",function(a){"use strict";var b=[];return{search:function(c,d){return(c||!b)&&(b=a.query(c,d)),b},get:function(c){var d;return b.forEach(function(a){a._id===c&&(d=a)}),d?d:a.get({id:c})}}}]),angular.module("app").controller("appHomeEditCtrl",["$scope","$location","$routeParams","appCachedHome","appGeocoder","appMap",function(a,b,c,d,e,f){"use strict";var g=["basic","details","description","pictures","contact"];a.id=c.id,a.step=c.step,a.home=d.get(a.id),a.getStep=function(){return"/partials/homes/edit/"+a.step},a.nextStep=function(c){d.set(a.home),b.path("/pro/home/"+a.id+"/"+c)},a.activeStep=function(b){return b===a.step},a.verify=function(){var c=g.indexOf(a.step)+1;a.home.$save().then(function(){d.set(a.home),b.path("/pro/home/"+a.home._id+"/"+g[c%g.length])},function(a){window.alert("Sorry there was an unexpected server error! Please contact us for help if this happens again."),console.log(a)})},a.geocode=function(){if(!a.geocoding){a.geocoding=!0;var b=a.home.address+","+a.home.postcode+", London UK";e.geocode(b).then(function(b){a.home.loc=[b.lat,b.lng],f.setCenter(b),a.geocoding=!1})}}}]),angular.module("app").controller("appHomeShowCtrl",["$scope","$routeParams","appCachedHomes",function(a,b,c){"use strict";a.home=c.get(b.id)}]),angular.module("app").directive("homeSideView",["appCachedHomes","$location",function(a,b){"use strict";return{restrict:"C",replace:!1,priority:1e3,templateUrl:"/partials/homes/show",controller:["$scope","$element",function(c){c.home={},c.path=b.path(),c.$on("appShowHome",function(b,d){c.home._id!==d._id&&(angular.element(document.getElementById("blackout")).addClass("show"),angular.element(document.getElementById("homeView")).addClass("show"),c.home._id=d._id,c.home=a.get(d._id))}),c.$on("appCloseShowHome",function(){c.close()}),c.close=function(){angular.element(document.getElementById("blackout")).removeClass("show"),angular.element(document.getElementById("homeView")).removeClass("show"),c.home={}}}]}}]),angular.module("app").controller("appIndexCtrl",["$scope","$location","$anchorScroll",function(a,b,c){"use strict";c(),a.gotoAbout=function(){b.hash("about")}}]),angular.module("app").value("appGoogle",window.google),angular.module("app").factory("appMap",["$rootScope",function(a){"use strict";return{setCenter:function(b){a.$broadcast("appMapSetCenter",b)},setMarker:function(b){a.$broadcast("appMapSetMarker",b)}}}]),angular.module("app").directive("googleMap",["appGoogle","appIsMobile",function(a,b){"use strict";function c(a){var c={zoom:13,minZoom:12,maxZoom:20,zoomControl:!1,zoomControlOptions:{style:f.maps.ZoomControlStyle.SMALL},center:g,mapTypeId:f.maps.MapTypeId.ROADMAP,scrollwheel:!b.any(),panControl:!1,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,overviewMapControl:!1,rotateControl:!1};e=new f.maps.Map(a,c)}function d(a){if(2===a.loc.length){var b=new f.maps.LatLng(a.loc[0],a.loc[1]),c=new f.maps.Marker({position:b,icon:h,map:e,animation:f.maps.Animation.DROP}),d=new f.maps.InfoWindow({content:'<div class="home-link" id="'+a._id+'">Click me!</div>'});f.maps.event.addListener(c,"click",function(){d.open(e,c)})}}var e,f=a,g=new f.maps.LatLng(51.5096283,-.1114692),h=new f.maps.MarkerImage("/img/pin-red.png",null,null,null,new f.maps.Size(40,52));return{restrict:"A",replace:!1,priority:1e3,controller:["$scope","$element","$rootScope",function(a,b,g){c(b[0]),a.$on("appMapSetCenter",function(a,b){e.setCenter(new f.maps.LatLng(b.lat,b.lng)),e.setZoom(16)}),a.$on("appMapSetMarker",function(a,b){d(b)}),b.on("click",function(a){"home-link"===a.target.className&&g.$broadcast("appShowHome",{_id:a.target.id})})}]}}]),angular.module("app").controller("appMapCtrl",["$scope","$rootScope","appCachedHomes","appMap",function(a,b,c,d){"use strict";a.search={pets:"None"},c.search({},function(a){a.forEach(function(a){var b={_id:a._id,loc:a.loc,price:a.price,beds:a.bedrooms,img:a.pictures[0]};d.setMarker(b)})}),a.closeView=function(){b.$broadcast("appCloseShowHome")}}]),angular.module("app").factory("appGeocoder",["appGoogle","$q",function(a,b){"use strict";function c(a){var c=b.defer();return e.geocode({address:a},function(a,b){if(b===d.maps.GeocoderStatus.OK){var e={lat:a[0].geometry.location.lat(),lng:a[0].geometry.location.lng()};c.resolve(e)}else window.alert("Geocode was not successful for the following reason: "+b)}),c.promise}var d=a,e=new d.maps.Geocoder;return{geocode:c}}]),angular.module("app").factory("appSearch",function(){"use strict"}),angular.module("app").controller("appProCtrl",["$scope","$location","appAuth","appNotifier",function(a,b,c,d){"use strict";a.signup=function(){var e={email:a.email,password:a.password,roles:["pro"]};c.createUser(e).then(function(){b.path("/pro/dashboard")},function(b){d.error(b,a)})}}]),angular.module("app").controller("appProDashboardCtrl",["$scope","appIdentity",function(a,b){"use strict";a.homes=b.currentUser.homes||[],a.hasHome=function(){return a.homes.length>0}}]),angular.module("app").controller("appProfileEditCtrl",["$scope",function(a){"use strict";a.id=0}]),angular.module("app").controller("appProfileShowCtrl",["$scope",function(a){"use strict";a.id=0}]),angular.module("app").controller("appSavedCtrl",["$scope",function(a){"use strict";a.readlater=[]}]);